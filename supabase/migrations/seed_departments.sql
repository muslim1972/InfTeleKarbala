-- 1. مسح البيانات السابقة (إن وجدت) لتهيئة الجدول، مع إزالة الارتباطات من profiles لمنع الأخطاء الطفيفة
UPDATE public.profiles SET department_id = NULL;
DELETE FROM public.departments;

-- 2. إدخال المستويات العليا (مستوى 1 و 2)
-- سنستخدم UUIDs ثابتة لسهولة الربط أدناه
WITH root_nodes AS (
  INSERT INTO public.departments (id, name, level, parent_id) VALUES
    ('11111111-1111-1111-1111-111111111111', 'مدير المديرية', 1, NULL),
    ('22222222-2222-2222-2222-222222222222', 'معاون مدير المديرية', 2, '11111111-1111-1111-1111-111111111111')
  RETURNING id, name
),

-- 3. إدخال (مستوى 3) الأقسام والشعب الرئيسية والمجمعات، وكلها تتبع للمعاون (أو المدير)
level_3 AS (
  INSERT INTO public.departments (id, name, level, parent_id) VALUES
    -- الأقسام
    ('33333333-1111-1111-1111-111111111111', 'القسم الاداري والمالي', 3, '22222222-2222-2222-2222-222222222222'),
    ('33333333-2222-2222-2222-222222222222', 'قسم تجهيز خدمات المعلوماتية', 3, '22222222-2222-2222-2222-222222222222'),
    ('33333333-3333-3333-3333-333333333333', 'قسم التراسل', 3, '22222222-2222-2222-2222-222222222222'),
    ('33333333-4444-4444-4444-444444444444', 'قسم الشبكات', 3, '22222222-2222-2222-2222-222222222222'),
    
    -- الشعب الرئيسية
    ('44444444-1111-1111-1111-111111111111', 'شعبة ادارة مكتب المدير', 3, '22222222-2222-2222-2222-222222222222'),
    ('44444444-2222-2222-2222-222222222222', 'الشعبة القانونية', 3, '22222222-2222-2222-2222-222222222222'),
    ('44444444-3333-3333-3333-333333333333', 'شعبة التخطيط والمتابعة', 3, '22222222-2222-2222-2222-222222222222'),
    ('44444444-4444-4444-4444-444444444444', 'شعبة التدقيق والرقابة الداخلية', 3, '22222222-2222-2222-2222-222222222222'),
    ('44444444-5555-5555-5555-555555555555', 'شعبة الـ (GIS)', 3, '22222222-2222-2222-2222-222222222222'),
    ('44444444-6666-6666-6666-666666666666', 'شعبة العلاقات والاعلام', 3, '22222222-2222-2222-2222-222222222222'),
    ('44444444-7777-7777-7777-777777777777', 'شعبة المباني', 3, '22222222-2222-2222-2222-222222222222'),
    ('44444444-8888-8888-8888-888888888888', 'شعبة القدرة', 3, '22222222-2222-2222-2222-222222222222'),
    
    -- المجمعات
    ('55555555-1111-1111-1111-111111111111', 'مجمع اتصالات سيد الشهداء (ع)', 3, '22222222-2222-2222-2222-222222222222'),
    ('55555555-2222-2222-2222-222222222222', 'مجمع اتصالات الهندية', 3, '22222222-2222-2222-2222-222222222222'),
    ('55555555-3333-3333-3333-333333333333', 'مجمع اتصالات الحر (ع)', 3, '22222222-2222-2222-2222-222222222222'),
    ('55555555-4444-4444-4444-444444444444', 'مجمع اتصالات الحسينية', 3, '22222222-2222-2222-2222-222222222222'),
    ('55555555-5555-5555-5555-555555555555', 'مجمع اتصالات الغدير', 3, '22222222-2222-2222-2222-222222222222'),
    ('55555555-6666-6666-6666-666666666666', 'مجمع اتصالات الخيرات', 3, '22222222-2222-2222-2222-222222222222'),
    ('55555555-7777-7777-7777-777777777777', 'مجمع اتصالات الجدول الغربي', 3, '22222222-2222-2222-2222-222222222222'),
    ('55555555-8888-8888-8888-888888888888', 'مجمع اتصالات عين التمر', 3, '22222222-2222-2222-2222-222222222222')
  RETURNING id, name
)

-- 4. إدخال الشعب الفرعية (مستوى 4) وربط كل منها بقسمها الأعلى
INSERT INTO public.departments (name, level, parent_id) VALUES
  -- شعب القسم الاداري والمالي
  ('شعبة الموارد البشرية', 4, '33333333-1111-1111-1111-111111111111'),
  ('شعبة الشؤون المالية', 4, '33333333-1111-1111-1111-111111111111'),
  ('شعبة الدفاع المدني', 4, '33333333-1111-1111-1111-111111111111'),
  ('شعبة الخدمات الادارية والنقليات', 4, '33333333-1111-1111-1111-111111111111'),
  ('شعبة المخازن', 4, '33333333-1111-1111-1111-111111111111'),
  ('وحدة تصفية الديون', 4, '33333333-1111-1111-1111-111111111111'),

  -- شعب قسم تجهيز خدمات المعلوماتية
  ('شعبة التسويق والمتابعة', 4, '33333333-2222-2222-2222-222222222222'),
  ('شعبة ادارة تجهيز الخدمة', 4, '33333333-2222-2222-2222-222222222222'),

  -- شعب قسم التراسل
  ('شعبة الاتصالات السلكية الضوئية', 4, '33333333-3333-3333-3333-333333333333'),
  ('شعبة الاتصالات اللاسلكية', 4, '33333333-3333-3333-3333-333333333333'),
  ('شعبة تناقل البيانات (IP)', 4, '33333333-3333-3333-3333-333333333333'),

  -- شعب قسم الشبكات
  ('شعبة الـ (FTTx)', 4, '33333333-4444-4444-4444-444444444444'),
  ('شعبة التصاميم', 4, '33333333-4444-4444-4444-444444444444'),
  ('شعبة البدالات والشبكات النحاسية', 4, '33333333-4444-4444-4444-444444444444');
